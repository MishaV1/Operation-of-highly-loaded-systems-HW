##  Задание 1. Systemd

Cоздадим файл для скрипта с помощью:

![img.png](images/img.png)

Сделаем его исполняем через ```sudo chmod +x /usr/local/bin/homework_service.sh```

С помощью sudo nano создадим systemd unit файл скрипта

![img_1.png](images/img_1.png)

для перезапуска каждые 15 секунд укажем
```
Restart=always
RestartSec=15
```

С помощью команд systemctl запустим сервис
```
sudo systemctl daemon-reload
sudo systemctl enable homework.service
sudo systemctl start homework.service
```
проверим его статус через ```systemctl status homework.service```

![img_2.png](images/img_2.png)

проверим логи скрипта

![img_3.png](images/img_3.png)

проверим перезапуск сервиса

![img_4.png](images/img_4.png)

Первые пять самых длительных systemd unit'ов

![img_5.png](images/img_5.png)

## Задание 2

Создадим файл с программой ```nano shm_creator.c```
Также скомпилируем и запустим программу

![img_6.png](images/img_6.png)

в отдельном окне используем ```ipcs -m```

![img_7.png](images/img_7.png)

Вывод:
Конкретно поле natch равное 0 означает, ни один процесс не использует разделяемую память

## Задание 3

Запустим python скрипт, который выделяет 250 Мбайт

![img_8.png](images/img_8.png)

Найдем PID нужного процесса, в моем случае 6560

![img_9.png](images/img_9.png)

Проанализируем использование памяти для python скрипта

![img_10.png](images/img_10.png)

В самом скрипте мы выделяем 250 Мбайт, но RSS показывает 259 и 270 для VSZ при округлении.
- RSS реальная память, которую мы загружаем в оперативку
- VSZ размер виртуальной памяти

Я применил ```pmap```, чтоб детальней посмотреть, на что тратиться память

![img_11.png](images/img_11.png)
![img_12.png](images/img_12.png)

Мы видим что для всех процессов программы выделяется память виртуальная и физическая,
так как виртуальная резервируется наперед, то почти на каждый процессе ее больше, чем используемая уже физически.

## Задание 4 

Кол-во NUMA нод на моей виртуалке:

![img_13.png](images/img_13.png)

Ограничиваю процессы с помощью systemd

![img_19.png](images/img_19.png)
![img_14.png](images/img_14.png)

Посмотрим на реальные значения памяти процесса

![img_15.png](images/img_15.png)

Взял другие значения и уменьшил объем памяти для stress

![img_16.png](images/img_16.png)
![img_18.png](images/img_18.png)

Посмотрим на реальные значения памяти процесса

![img_17.png](images/img_17.png)

При повышении и понижении памяти с процессом, конкретно ничего не происходит, ошибок я не нашел,
но выделяема память действительно изменяется.
По сути MemoryMax ограничивает кол-во памяти оперативки на процесс, а с помощью CPUWeight мы можем приоритизировать процессы.